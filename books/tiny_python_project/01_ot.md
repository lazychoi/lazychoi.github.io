# 01장 파이썬 프로그램 작성 및 테스트 방법
created: 2022-10-10
## pytest 사용법

`$ pytest -xv test.py`

- 저자가 작성한 test.py를 실행한다.
- v 옵션은 테스트 결과를 상세히 보여준다.
- x 옵션은 테스트 실패 시점에 실행을 중단한다. 


## 셔뱅(#!, shebang)

OS가 해당 파일을 어떤 언어로 처리할지 정하기 위해 사용한다. 파이썬은 무시한다. 파일 첫 줄에 아래 문장 추가한다.

`#!/usr/bin/env python3`

- 이후 ==python 명령 없이 바로 실행 가능.== eg. `$ ./hello.py`로 실행 
- 파일이 실행가능한 권한이 있어야 함(chmod -x 파일명)  


## env

- PC의 환경 출력: SHELL, USER, HOME, PATH, ....
- 환경값만 출력하려면: `$ echo $SHELL` 등 명령 사용
- 특정 프로그램을 찾아서 실행할 때 사용: `$ env python`


## 프로그램에 도움말 추가 argparse

`$ ./hello.py -h` 명령어를 입력하면 도움말이 출력되도록 설정한다.

**argparse** 모듈은 프로그램에 인수를 전달하는 기능을 한다.



## 프로그램에 인수(argument) 추가하도록 설정

프로그램에서 변경하고자 하는 부분을 찾아서 그곳에 들어갈 값을 인수로 전달한다. 

- 대시(-)로 시작하는 것은 옵션(option) 인수로, 지정하지 않아도 동작하며 기본값을 가짐
- 대시가 없는 것은 위치(position) 인수로, 반드시 지정해야 하며 기본값을 갖지 않음

```python
#! /usr/bin/env python
# 셔뱅은 이 코드를 실행할 때 어떤 프로그램을 사용할지 os에게 알려줌

# 인수를 전달할 때 사용하는 모듈
import argparse

# 이 parser가 모든 인수를 인지한다. description에 있는 내용이 도움말로 표시됨
parser = argparse.ArgumentParser(description='Say hello')

# 인사할 사람의 이름('name')을 인수로 전달한다고 파서에게 알려줌
# parser.add_argument('name', help='Name to greet')

# '-n'과 '--name'을 각각 축약형(short)과 일반형(long) 인수명으로 추가
# 인수명을 추가하지 않을 경우 기본값인 'world'가 출력됨
# 'metavar'는 인수명
parser.add_argument('-n', '--name', metavar='name', default='world', help='Name to greet')

# 인수를 프로그램에게 전달하라고 파서에게 지시
args = parser.parse_args()

# args.name 값을 사용해 인사 메시지 출력(metavar에 지정한 이름)
print("Hello, " + args.name + "!")


# 실행 결과 ======================================
# $ ./hello.py => Hello, World!
# $ ./hello.py -n Jun => Hello, Jun!
# $ ./hello.py -h => 도움말 출력
# usage: hello.py [-h] [-n name]
#
# Say hello
#
# optional arguments:
#   -h, --help            show this help message and exit
#   -n name, --name name  Name to greet

```


## main(), get_args() 함수 추가

프로그램은 main()이라는 위치에서 시작하는 게 일반적이다.

```python
#! /usr/bin/env python
# 셔뱅은 이 코드를 실행할 때 어떤 프로그램을 사용할지 os에게 알려줌

# 인수를 전달할 때 사용하는 모듈
import argparse

def get_args():
    '''
    인수 전용 함수
    '''
    # 이 parser가 모든 인수를 인지한다. description에 있는 내용이 도움말로 표시됨
    parser = argparse.ArgumentParser(description='Say hello')

    # 인사할 사람의 이름('name')을 인수로 전달한다고 파서에게 알려줌
    # parser.add_argument('name', help='Name to greet')

    # '-n'과 '--name'을 각각 축약형(short)과 일반형(long) 인수명으로 추가
    # 인수명을 추가하지 않을 경우 기본값인 'world'가 출력됨
    # 'metavar'는 인수명
    parser.add_argument('-n', '--name', metavar='name', default='World', help='Name to greet')

    return parser.parse_args()


def main():
    args = get_args()
    
    # args.name 값을 사용해 인사 메시지 출력(metavar에 지정한 이름)
    print("Hello, " + args.name + "!")


# 모든 프로그램과 모듈은 __name__이라는 변수로 접근할 수 있는 이름을 갖고 있다.
# 프로그램이 실행될 때 __name__이 __main__이라는 값으로 설정된다.
if __name__ == '__main__':
    main()
    
```


## 스타일 및 오류 확인 using linter

black 또는 YAPF 실행

`$ black hello.py`

flake8

```
$ flake8 hello.py
hello.py:7:1: E302 expected 2 blank lines, found 1      <- 함수 사이는 두 줄 띄우기
hello.py:20:80: E501 line too long (94 > 79 characters) <- 코드 길이가 79자 이상
hello.py:27:1: W293 blank line contains whitespace      <- 빈 줄에 공백문자 있음
```

pylint

```
❯ pylint hello.py
************* Module hello
hello.py:1:0: C0114: Missing module docstring (missing-module-docstring)
hello.py:27:0: C0116: Missing function or method docstring (missing-function-docstring)

-----------------------------------
Your code has been rated at 8.00/10
```

셔뱅 다음 줄과 함수 선언 다음 줄에 문서 정보 추가 후 다시 실행하면 점수가 만점으로 오른다.

